# Лабораторная работа №10 - Проксирование трафика. Squid.

## Общие сведения
В рамках данного практического задания, обучающийся получит начальные навыки проксирования интернет-трафика в корпоративных сетях и эксплуатации популярного прокси-сервера Squid. 
Для выполнения заданий необходимы виртуальные машины с операционными системами Debian 10 и Windows 7 (и выше).

## План выполнения задания
1) Подготовьте виртуальный стенд, состоящий из 3-х машин:
    - Сервер, предоставляющий доступ к сети интернет на базе Debian Linux, далее VM1
    - Рабочая станция с ОС Linux без графического интерфейса. Далее VM2
    - Рабочая станция с ОС Windows 7-10, далее – VM3
2) Подготовьте стенд к работе:
    - Произведите настройку сети VM1: задействуйте 2 сетевых интерфейса. В качестве первого сетевого адаптера используйте тип NAT. В качестве второго – виртуальный адаптер хоста
    - Произведите настройку сети VM2: задействуйте 1 сетевой адаптер с типом виртуальный адаптер хоста
    - Произведите настройку сети VM3: задействуйте 1 сетевой адаптер с типом виртуальный адаптер хоста
    - Настройте IP-адреса виртуальных машин:
        - VM1 – NAT, 192.168.56.2
        - VM2 – 192.168.56.10
        - VM3 – 192.168.56.100
    - Запустите стенд и убедитесь в его работоспособности по правилу «все видят всех»
3) На VM1 установите и сконфигурируйте прокси-сервер Squid следующим образом:
    - Создайте правило для машиныVM2, по которому доступ с данной VM возможен только на сервера репозитория Debian (выберите источник сами)
    - Создайте правило для машины VM3 по которому доступ с данной машины возможен на все интернет-адреса, кроме «черного списка»
    - «Черный список» должен быть организован в виде текстового файла
4) Осуществите мониторинг и контроль доступа к интернету со стороны виртуальных машин VM2 и VM3
5) Настройте системы аутентификации, отличную от аутентификации по IP-адресам:
    - Установите базу MariaDB (аналог СУБД MySQL)
    - Создайте базу squid
    - Создайте учетную запись squiduser, задайте ей пароль (12345678 в качестве тестового) и предоставьте данной учетной записи доступ к базе данных squid только с локального компьютера. В нашем (тестовом) случае права доступа можно задать максимальные
    - Создайте таблицу passwd используя SQL-команду:
        ```
        CREATE TABLE passwd ( user varchar(32) NOT NULL default '', password varchar(35) NOT NULL default '', enabled tinyint(1) NOT NULL default '1', fullname varchar(60) default NULL, comment varchar(60) default NULL, PRIMARY KEY (user) );
        ```
    - Добавьте в базу не менее 2-х учетных записей. Сделать это можно, например, SQL-командой: 
        ```
        insert into passwd values('testuser','test',1,'Test User','for testing purpose');
        ```
    - Сконфигурируйте прокси-сервер Squid для аутентификации через MySQL путем добавления в  начало конфигурационного файла: 
        ```
        auth_param basic program /usr/lib/squid3/basic_db_auth --user squiduser --password 12345678 
        --plaintext --persist
        auth_param basic children 5
        auth_param basic realm Web-Proxy
        auth_param basic credentialsttl 2 minute
        auth_param basic casesensitive off
        acl db-auth proxy_auth REQUIRED
        ```
    - Приведите порядок выполнения правил к следующему виду:
        ```
        # запрещено все, что не разрешено
        http_access allow localhost
        http_access allow db-auth  <------- (добавить)
        http_access deny home_network
        http_access deny all
        ```
6) Убедитесь в работоспособности авторизации через СУБД MySQL.