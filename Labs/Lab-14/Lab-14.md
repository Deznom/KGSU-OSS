# Лабораторная работа №14: Проброс портов через SSH

#### **Цель работы:**  
Освоить технику туннелирования TCP-соединений через SSH для безопасного доступа к сервисам, работающим на защищенных серверах. В рамках работы будет настроен доступ к веб-серверу Apache через SSH-туннель с использованием любого SSH-клиента.

---

## **1. Подготовка стенда**

### **1.1. Состав стенда**
| Машина       | ОС                | Роль                     | IP-адрес      |
|--------------|-------------------|--------------------------|---------------|
| **VM1**      | Debian Linux      | SSH-сервер + Apache      | 192.168.56.5  |
| **VM2**      | Любая ОС         | Клиент                   | 192.168.56.10 |

### **1.2. Требования к ПО**
- На VM1: установленные `openssh-server` и `apache2`
- На VM2: любой SSH-клиент:
  - Linux/macOS: встроенный `ssh`
  - Windows: PuTTY/WinSCP/Tabby

---

## **2. Настройка серверной части (VM1)**

### **2.1. Установка и настройка Apache**
```bash
sudo apt update && sudo apt install -y apache2
echo "<h1>Тестовый веб-сервер</h1>" | sudo tee /var/www/html/index.html
sudo systemctl enable --now apache2
```

### **2.2. Настройка SSH-сервера**
```bash
sudo nano /etc/ssh/sshd_config
```
Убедитесь, что есть параметры:
```ini
AllowTcpForwarding yes
GatewayPorts yes
```
Перезапустите SSH:
```bash
sudo systemctl restart ssh
```

---

## **3. Проброс портов с клиента (VM2)**

### **3.1. Локальный проброс (Local Port Forwarding)**
#### **Для Linux/macOS:**
```bash
ssh -L 8080:localhost:80 user@192.168.56.5
```
Где:
- `8080` – локальный порт на клиенте
- `80` – порт Apache на сервере

#### **Для Windows (PuTTY):**
1. В разделе "Connection > SSH > Tunnels":
2. Введите:
   - Source port: `8080`
   - Destination: `localhost:80`
3. Выберите "Local" и нажмите "Add"

### **3.2. Проверка работоспособности**
Откройте в браузере:
```
http://localhost:8080
```
Должна появиться страница "Тестовый веб-сервер".

---

## **4. Удаленный проброс (Remote Port Forwarding)**

### **4.1. Настройка проброса**
#### **Linux/macOS:**
```bash
ssh -R 9080:localhost:80 user@192.168.56.5
```
Где:
- `9080` – порт на сервере
- `80` – порт на клиенте

#### **Windows (PuTTY):**
1. В том же разделе Tunnels:
2. Введите:
   - Source port: `9080`
   - Destination: `localhost:80`
3. Выберите "Remote" и нажмите "Add"

### **4.2. Проверка на сервере**
```bash
curl http://localhost:9080
```
Должен вернуться HTML-код страницы.

---

### **Дополнительные задания**
1. Настроить проброс портов в клиенте Tabby.
2. Настроить аутентификацию по ключам (на сервере и клиенте).