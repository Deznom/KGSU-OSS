# Лабораторная работа №0 - Подготовка виртуальной машины на Debian и настройка SSH

## Словарь
- VirtualBox (Oracle VM VirtualBox) - это программное решение для виртуализации, позволяющее запускать несколько виртуальных машин на одном физическом компьютере. Поддерживает широкий спектр операционных систем, включая Windows, Linux, macOS, и другие.
- SSH (Secure Shell) - это сетевой протокол для безопасного удаленного управления операционной системой через командную строку. Он обеспечивает передачу данных в зашифрованном виде, позволяя выполнять различные задачи на удаленном сервере, такие как управление файлами, редактирование конфигураций, и даже запуск приложений.
- SSH-клиент - это программа, которая устанавливается на локальном компьютере пользователя и позволяет подключаться к удаленному серверу через SSH (Secure Shell) протокол.
- Виртуальная машина (ВМ) – это виртуальный компьютер, который использует ресурсы реального компьютера (процессор, диск, адаптер) и работает автономно. ВМ позволяет создать на одном компьютере ещё один компьютер, который будет использовать его ресурсы, но работать изолированно.
- NAT (Network Address Translation) – это технология, которая позволяет перенаправлять трафик между локальной сетью (LAN) и глобальной сетью (WAN), используя один публичный IP-адрес для множества устройств в локальной сети. Это экономит количество используемых IP-адресов и обеспечивает дополнительную безопасность, скрывая локальные IP-адреса от внешней сети. Существует три основных типа NAT: статический, динамический и PAT (Port Address Translation).

## Предварительные требования
- [Установщик хоста VirtualBox 7.0](https://www.virtualbox.org/wiki/Downloads)
- [Образ ОС Debian 12.7.0](https://www.debian.org/index.ru.html) | Можно скачать по ссылке или взять у преподавателя
- Установщик SSH клиента по своему вкусу | [Современный и красивый Tabby](https://tabby.sh/) | [Старый и надежный Bitvise](https://bitvise.com/ssh-client-download) | [Простой и дубовый PuTTY](https://www.putty.org/)
- Соединение с Интернетом

## Что должно получиться в результате выполнения
VirtualBox с установленным DebianServer:
- без графической оболочки, с установленным SSH сервером;
- с двумя сетевыми интерфейсами:
    - один для доступа в Интернет;
    - другой для связи с машиной-хостом;
- подключенный к созданной ВМ SSH-клиент.

## План работы
Обращаю внимание, что любой из пунктов можно пропустить, если Вы считаете, что он уже по каким-либо причинам выполнен.
1) [Установка VirtualBox](#1-установка-virtualboxУстановка-VirtualBox)
2) [Установка Debian и настройка ВМ](#2-установка-debian-и-настройка-вм)
3) [Конфигурация сетевых адаптеров](#3-конфигурация-сетевых-адаптеров)
4) [Подключение к ВМ по SSH](#4-подключение-к-вм-по-ssh)

## 1. Установка VirtualBox

Устанавливаем VirtualBox, следуя инструкциям установщика. 

Единственное, на что нужно обратить внимание - это на установку сетевых интерфейсов:

![Установка сетевых интерфейсов](Images/Lab-0-1.png)

Во время установки может появиться диалоговое окно, похожее на это:

![Установка оборудования](Images/Lab-0-2.jpg)

Необходимо согласиться с установкой. После успешной установки VirtualBox, рекомендуется перезагрузить ПК.

## 2. Установка Debian и настройка ВМ

Открываем VirtualBox и в менеджере нажимаем кнопку "Создать":

![Создание ВМ](Images/Lab-0-3.png)

В помощнике создания ВМ:
- указываем имя ВМ - DebianServer;
- выбираем папку, где будут размещаться файлы ВМ;
- выбираем ранее скачанный образ Debian;
- **ставим галку "Пропустить автоматическую установку"**.

![Создание ВМ](Images/Lab-0-4.png)

В оборудовании:
- указываем объем оперативной памяти = 2 ГБ (это значение можно будет изменить позднее, при необходимости);
- ставим 2 процессорных ядра (тоже можно будет поменять позднее).

![Создание ВМ](Images/Lab-0-5.png)

В виртуальном жестком диске:
- выставляем побольше места, желательно 40+ ГБ (спойлер: это понадобится позднее, когда будем работать с Volatility Framework и дампами оперативной памяти ОС);
- **не ставим галку "Выделить место в полном размере"**.

![Создание ВМ](Images/Lab-0-6.png)

Далее проверяем все параметры и создаем ВМ, нажатием кнопки "Готово":

![Создание ВМ](Images/Lab-0-7.png)

В менеджере VirtualBox выбираем только что созданную ВМ "DebianServer" и запускаем её. **Напоминаю, к этому моменту у вас уже должно быть активное соединение с интернетом! Это нужно, чтобы при установке не иметь проблем с автоматической настройкой сетевого интерфейса с NAT, а также скачиванием недостающих пакетов.**

![Установка ВМ](Images/Lab-0-8.png)

Теперь, когда ВМ запустится, мы увидим приветствие установщика Debian, сразу нажмем Enter, чтобы выбрать графический установщик:

![Установка ВМ](Images/Lab-0-9.png)

С этого момента **УБЕДИТЕЛЬНАЯ ПРОСЬБА читать, что вам пишет установщик! Не надо вслепую и бездумно тыкать на кнопку "Далее", это ни к чему хорошему обычно не приводит**. Далее приведу набор скриншотов с комментариями, на которых продемонстрировано, как у вас должно по итогу получиться.

Выбираем страну, язык, часовой пояс:

![Установка ВМ](Images/Lab-0-10.png)

![Установка ВМ](Images/Lab-0-11.png)

Имя компьютера оставляем по умолчанию "debian":

![Установка ВМ](Images/Lab-0-12.png)

Домен укажем например "debian.local":

![Установка ВМ](Images/Lab-0-13.png)

Пароль суперпользователя для простоты запоминания и использования укажем "12345678" **(НИКОГДА ТАК НЕ ДЕЛАЙТЕ НА СВОИХ ДОМАШНИХ РАБОЧИХ КОМПЬЮТЕРАХ)**:

![Установка ВМ](Images/Lab-0-14.png)

Полное и короткое имя пользователя для простоты использования укажем "user", пароль пользователю поставим такой же, какой поставили суперпользователю "12345678":

![Установка ВМ](Images/Lab-0-15.png)

![Установка ВМ](Images/Lab-0-16.png)

В разметке дисков выбираем "авто":

![Установка ВМ](Images/Lab-0-17.png)

Выбираем единственный присутствующий диск:

![Установка ВМ](Images/Lab-0-18.png)

Для простоты использования, будем размещать все файлы ОС в одном разделе:

![Установка ВМ](Images/Lab-0-19.png)

Выбираем пункт "Закончить разметку и записать изменения на диск":

![Установка ВМ](Images/Lab-0-20.png)

На вопрос "Записать изменения на диск" отвечаем "Да", нажимаем "Продолжить":

![Установка ВМ](Images/Lab-0-21.png)

Ждем окончания установки базовой системы:

![Установка ВМ](Images/Lab-0-22.png)

После завершения установки, отказываемся от сканирования второго носителя:

![Установка ВМ](Images/Lab-0-23.png)

На вопрос "Использовать зеркало архива из сети?" отвечаем "Да":

![Установка ВМ](Images/Lab-0-24.png)

Выбираем указанный регион и зеркало, информацио о прокси не указываем:

![Установка ВМ](Images/Lab-0-25.png)

![Установка ВМ](Images/Lab-0-26.png)

~~Наверное, один из самых главных пунктов установки Debian~~ 

Это, между прочим, один из пунктов, ради которых я прошу вас внимательно читать, что вам пишет установщик. Чтобы не было вопросов "а что тут выбирать?", нужно просто прочитать этот пункт от начала и до конца, а затем принять решение, надо оно вам или нет.

Отказываемся от участия в опросе популярности пакетов (если очень хочется, то можно):

![Установка ВМ](Images/Lab-0-27.png)

**ВАЖНО:** в конечном итоге нам нужно получить Debian без графической оболочки и с установленным SSH сервером, поэтому снимаем галки с "окружение рабочего стола Debian" и "... GNOME", ставим галку "SSH-сервер".

![Установка ВМ](Images/Lab-0-28.png)

**ЕЩЕ ОДИН ВАЖНЫЙ ПУНКТ:** GRUB надо ставить **ОБЯЗАТЕЛЬНО**, иначе ваша операционная система просто не будет загружаться. Опять же, чтобы понять, нужно устанавливать GRUB или нет, достаточно прочитать, что вам написал установщик.

![Установка ВМ](Images/Lab-0-29.png)

Выбираем диск, на который мы установили Debian (также будет не лишним прочитать этот пункт полностью):

![Установка ВМ](Images/Lab-0-30.png)

Поздравляю! Вы справились с установкой Debian!

![Установка ВМ](Images/Lab-0-31.png)

Можно перезагрузить ВМ, а затем выключить её.

## 3. Конфигурация сетевых адаптеров

При создании новой ВМ, для нее по умолчанию создается один адаптер с [NAT](#словарь), который используется для доступа в Интернет. Через этот адаптер нельзя установить связь с машиной-хостом.

Для связи с машиной-хостом, нам необходимо выполнить следующее:

В менеджере VirtualBox выбрать нашу ВМ и нажать кнопку "Настроить". **ВМ должна быть выключена**:

![Настройка сетевых адаптеров ВМ](Images/Lab-0-32.png)

В настройках ВМ:
- выбрать вкладку "Сеть";
- выбрать вкладку "Адаптер 2", он будет выключен;
- поставить галку "Включить сетевой адаптер";
- выбрать Тип подключения "Виртуальный адаптер хоста"

![Настройка сетевых адаптеров ВМ](Images/Lab-0-33.png)

Сохраняем настройки и запускаем ВМ. Входим под логином пользователя user, с паролем "12345678". Обратите внимание, что консольный интерфейс не отображает вообще никакие символы при вводе пароля, поэтому может показаться, что ничего не происходит. Это не так, пароль вводится.

![Настройка сетевых адаптеров ВМ](Images/Lab-0-34.png)

Переходим в режим суперпользователя с помощью команды `su`. Вводим пароль суперпользователя "12345678".

![Настройка сетевых адаптеров ВМ](Images/Lab-0-35.png)

С помощью команды `ip a`, проверим, что у нас действительно подключено два сетевых интерфейса. Это должны быть интерфейсы enp0s3 и enp0s8:

![Настройка сетевых адаптеров ВМ](Images/Lab-0-36.png)

Обратите внимание, что интерфейс enp0s8 не проинициализирован, в отличие от enp0s3. Сконфигурируем интерфейс enp0s8 вручную. Для этого вводим команду `nano /etc/network/interfaces`, чтобы открыть файл с конфигурацией сетевых интерфейсов с помощью текстового редактора nano. Необходимо привести содержимое этого файла к следующему виду:

```
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface
allow-hotplug enp0s3
iface enp0s3 inet dhcp

allow-hotplug enp0s8
iface enp0s8 inet static
        address 192.168.56.2/24
        gateway 192.168.56.1
```

Этим самым мы зададим статический адрес для интерфейса `192.168.56.2`.

Далее сохраняем файл с помощью сочетания клавиш `Ctrl+O` -> `Enter`. Выходим из редактора с помощью сочетания клавиш `Ctrl+X`. 

Затем, чтобы применить изменения, внесенные в файл интерфейсов, нам необходимо перезапустить сетевую службу с помощью команды `systemctl restart networking`

После успешного перезапуска сетевых служб, можно проверять связь с машиной-хостом с помощью команды `ping 192.168.56.1`. Прервать отправку пакетов можно с помощью сочетания клавиш Ctrl+C.

![Настройка сетевых адаптеров ВМ](Images/Lab-0-37.png)

Если пинги не проходят - перепроверьте файл /etc/network/interfaces и перезапустите сетевые службы еще раз. Как крайнюю меру можно пробовать перезапуск ВМ и машины-хоста.

На этом настройка сетевых интерфейсов завершена.

## 4. Подключение к ВМ по SSH

Конфигурация подключения к ВМ по SSH будет производиться на примере SSH клиента [Tabby](#предварительные-требования).

На главном экране Tabby выбираем "Profiles & Connections"

![Настройка SSH-клиента](Images/Lab-0-38.png)

Выбираем "Manage profiles":

![Настройка SSH-клиента](Images/Lab-0-39.png)

Нажимаем "+ New" -> "+ New profile"

![Настройка SSH-клиента](Images/Lab-0-40.png)

Выбираем "SSH connection"

![Настройка SSH-клиента](Images/Lab-0-41.png)

Внутри вводим:
- Name "debian"
- Host "192.168.56.2"
- Username "user"
- Authentication method выбираем "Password", здесь же можно задать пароль с помощью кнопки "Set password". Напоминаю пароль - 12345678.

![Настройка SSH-клиента](Images/Lab-0-42.png)

Нажимаем "Save". Открываем созданный профиль. Вводим пароль, если не ввели на предыдущем этапе. Принимаем и сохраняем ключ хоста.

![Настройка SSH-клиента](Images/Lab-0-43.png)

Готово. Настройка SSH-клиента завершена, мы успешно подключились к нашей ВМ с помощью SSH. 

**При выполнении лабораторных работ по Linux, всегда используйте подключение по SSH.**